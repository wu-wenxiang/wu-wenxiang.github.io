---
layout:         post
title:          ASP.NET-MVC5教程
category:       course
description:    MVC5简明教程，示例使用VS2015和.NET 4.6.1框架，完整地覆盖了ASP.NET MVC5的框架组成，开发调试和部署。
---

## 简介

### 前言

本教程基于微软[ASP.NET-MVC5官方文档](http://www.asp.net/mvc/overview/getting-started/introduction/getting-started)修订而成。文中将VS版本从官方文档的VS2013修改为2015，并且增加了基础内容，缩减了高级部分，形成简明版本，以便入门。

### MVC框架的演变

- MVC1-MV4的演变可以参考如下：
	1. [MVC1-MVC2](http://www.asp.net/mvc/overview/older-versions-1)
	1. [MVC3-MVC4](http://www.asp.net/mvc/overview/older-versions)
- MVC5是针对之前版本的一个集大成者，几乎完美，只是不推荐跨平台。
- MVC6是一个颠覆版本，构建于ASP.NET5之上，为跨平台而生。

### Pre-Requirement
- Visual Studio 2015
- ASP.NET 4.6.1
- IIS 7.5+

### Source Code
- [Github](https://github.com/wu-wenxiang/wwxPOC/tree/master/asp.net_mvc/mvcPOC)

## Quick Start

### Create a New MVC Project

![newProject.png](http://7xudfs.com1.z0.glb.clouddn.com/4d7ac251b31c453382216147ee032bd5-newProject.png)
![newProjectWeb.png](http://7xudfs.com1.z0.glb.clouddn.com/4d7ac251b31c453382216147ee032bd5-newProjectWeb.png)
![newProjectMVC.png](http://7xudfs.com1.z0.glb.clouddn.com/4d7ac251b31c453382216147ee032bd5-newProjectMVC.png)

###  Setting IISExpress

![iisExpressShowAll.png](http://7xudfs.com1.z0.glb.clouddn.com/4d7ac251b31c453382216147ee032bd5-iisExpressShowAll.png)
![iisExpressSetting.png](http://7xudfs.com1.z0.glb.clouddn.com/4d7ac251b31c453382216147ee032bd5-iisExpressSetting.png)

- 按F5会开始Debug，VS会直接以Attach的方式启动IISExpress
- 按Ctrl + F5，不debug，此时可以修改源代码，编译后刷新Browser页面可以应用新代码
- Ctrl + Alt + P: 可以Attach到指定的进程

## Router

### Add Router

![routerGlobal.png](http://7xudfs.com1.z0.glb.clouddn.com/4d7ac251b31c453382216147ee032bd5-routerGlobal.png)
![routerFormat.png](http://7xudfs.com1.z0.glb.clouddn.com/4d7ac251b31c453382216147ee032bd5-routerFormat.png)

- 按F12，可以进入定义位置
- 上图中，url表示了Route的样式：
	1. 默认的Controller是Home
	1. 对所有的Controller，默认的Action都是Index
	1. id是可选的

## Controller

### Add Controller

![addController.png](http://7xudfs.com1.z0.glb.clouddn.com/4d7ac251b31c453382216147ee032bd5-addController.png)
![addControllerMVC5.png](http://7xudfs.com1.z0.glb.clouddn.com/4d7ac251b31c453382216147ee032bd5-addControllerMVC5.png)
![addControllerName.png](http://7xudfs.com1.z0.glb.clouddn.com/4d7ac251b31c453382216147ee032bd5-addControllerName.png)

### QureyString
- QueryString字符串会自动传给Action方法对应的形参
- 我们可以在Action方法中指定默认参数

![QueryString.png](http://7xudfs.com1.z0.glb.clouddn.com/4d7ac251b31c453382216147ee032bd5-QueryString.png)
![QueryStringDefault.png](http://7xudfs.com1.z0.glb.clouddn.com/4d7ac251b31c453382216147ee032bd5-QueryStringDefault.png)

- 这里的HttpUtility.HtmlEncode 也可以写成 Server.HtmlEncode，Server是HttpUtility的一个实现


### Validate Request

- 如果我们输入可能造成注入攻击的内容，可以看到页面报错，这个Request Validation机制和HtmlEncode无关，是在MiddleWare层做掉的。

![RequestValidationError.png](http://7xudfs.com1.z0.glb.clouddn.com/4d7ac251b31c453382216147ee032bd5-RequestValidationError.png)
	
- 如果要屏蔽此报错，可以参考[MSDN](https://msdn.microsoft.com/en-us/library/hh882339\(v=vs.110\).aspx)，请注意：
	1. 针对WebForm / MVC / Web Pages有不同的改法
	2. 该步骤适用于.NET 4.5及以上版本

### Encode HTML

- 如果不使用HTMLEncode，虽然RequestValidation可以通过，但我们依然无法把HtmlTag等字符注入到页面中。

![HTMLEncode1.png](http://7xudfs.com1.z0.glb.clouddn.com/4d7ac251b31c453382216147ee032bd5-HTMLEncode1.png)

![HTMLEncode2.png](http://7xudfs.com1.z0.glb.clouddn.com/4d7ac251b31c453382216147ee032bd5-HTMLEncode2.png)

- 使用HTMLEncode之后，就可以了

![HTMLEncode3.png](http://7xudfs.com1.z0.glb.clouddn.com/4d7ac251b31c453382216147ee032bd5-HTMLEncode3.png)

## View

### Add View

![AddView1.png](http://7xudfs.com1.z0.glb.clouddn.com/4d7ac251b31c453382216147ee032bd5-AddView1.png)
![AddView2.png](http://7xudfs.com1.z0.glb.clouddn.com/4d7ac251b31c453382216147ee032bd5-AddView2.png)

### Template-CSHTML

- Control通过View()方法关联到CSHTML

![cshtml1.png](http://7xudfs.com1.z0.glb.clouddn.com/4d7ac251b31c453382216147ee032bd5-cshtml1.png)
![cshtml2.png](http://7xudfs.com1.z0.glb.clouddn.com/4d7ac251b31c453382216147ee032bd5-cshtml2.png)

- CSHTML可以直接浏览

![cshtml3.png](http://7xudfs.com1.z0.glb.clouddn.com/4d7ac251b31c453382216147ee032bd5-cshtml3.png)

- View Layout

![ViewLayout1.png](http://7xudfs.com1.z0.glb.clouddn.com/4d7ac251b31c453382216147ee032bd5-ViewLayout1.png)
![ViewLayout2.png](http://7xudfs.com1.z0.glb.clouddn.com/4d7ac251b31c453382216147ee032bd5-ViewLayout2.png)

### Controller & View

- 如果View()对应的模板文件不存在，会报错

![cshtml4.png](http://7xudfs.com1.z0.glb.clouddn.com/4d7ac251b31c453382216147ee032bd5-cshtml4.png)

- 如何将Controller中的变量传递给View？

![cshtml5.png](http://7xudfs.com1.z0.glb.clouddn.com/4d7ac251b31c453382216147ee032bd5-cshtml5.png)

## Model

### Add Model

- Create Model Class

![AddModel1.png](http://7xudfs.com1.z0.glb.clouddn.com/4d7ac251b31c453382216147ee032bd5-AddModel1.png)
![AddModel2.png](http://7xudfs.com1.z0.glb.clouddn.com/4d7ac251b31c453382216147ee032bd5-AddModel2.png)

- 编写Model & DBContext

![AddModel3.png](http://7xudfs.com1.z0.glb.clouddn.com/4d7ac251b31c453382216147ee032bd5-AddModel3.png)
![AddModel5.png](http://7xudfs.com1.z0.glb.clouddn.com/4d7ac251b31c453382216147ee032bd5-AddModel5.png)

- 可以去掉无用的引用

![AddModel4.png](http://7xudfs.com1.z0.glb.clouddn.com/4d7ac251b31c453382216147ee032bd5-AddModel4.png)

- 在Web.config中添加Web.config

![AddModel6.png](http://7xudfs.com1.z0.glb.clouddn.com/4d7ac251b31c453382216147ee032bd5-AddModel6.png)

## Publish
